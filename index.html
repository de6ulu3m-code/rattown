<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä—ã—Å–æ-–ì—Ä–∞–¥: –°–∏—Ç–∏-–ú–µ–Ω–µ–¥–∂–µ—Ä</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #ffcc00; --bg: #222; --blue: #4a69bd; --sewer: #3d3d3d; --island: #e67e22; }
        body {
            background-color: var(--bg); color: white;
            font-family: 'Noto Color Emoji', 'Courier New', monospace; 
            display: flex;
            flex-direction: column; align-items: center; margin: 0; min-height: 100vh;
        }
        .city-header {
            background: #111; width: 100%; text-align: center;
            padding: 15px; border-bottom: 3px solid var(--gold);
        }
        .container {
            width: 90%; max-width: 400px; text-align: center; margin-top: 20px;
        }
        
        /* –°—Ç–∏–ª–∏ —Ä—ã–Ω–∫–∞ */
        #market-game {
            background: #333; border: 3px dashed var(--gold);
            height: 300px; position: relative; overflow: hidden;
            display: none; cursor: crosshair; margin-top: 10px;
        }
        .falling-item {
            position: absolute; font-size: 30px; cursor: pointer;
            user-select: none; transition: top 0.1s linear;
        }
        
        .stat-bar { font-size: 1.2rem; margin: 10px 0; color: var(--gold); }
        .btn {
            background: #555; color: white; border: none; padding: 10px 20px;
            border-radius: 5px; cursor: pointer; margin: 5px;
            font-family: 'Noto Color Emoji', 'Courier New', monospace;
            transition: 0.2s;
        }
        .btn:hover { background: var(--gold); color: black; }
        
        /* –°—Ç–∏–ª–∏ –ú—ç—Ä–∏–∏ –∏ –Ω–æ–≤—ã—Ö –∑–æ–Ω */
        #cityhall-view, #sewer-view, #island-view { display: none; padding: 20px; border: 3px solid var(--gold); border-radius: 15px; }
        #cityhall-view { background: #2c3e50; }
        #sewer-view { background: #1a1a1a; border-color: #555; }
        #island-view { background: #f1c40f; color: black; border-color: var(--island); }

        .upgrade-card { background: rgba(0,0,0,0.3); padding: 10px; margin: 10px 0; border-radius: 8px; border-left: 4px solid var(--gold); text-align: left; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="city-header">
    <h1>üèôÔ∏è –ö–†–´–°–û-–ì–†–ê–î</h1>
    <div class="stat-bar">–°—ã—Ä –≤ –∫–∞—Ä–º–∞–Ω–µ: <span id="balance">0</span> üßÄ</div>
    <div style="font-size: 0.8rem; color: #2ecc71;">–î–æ—Ö–æ–¥: +<span id="tax-val">0</span> üßÄ/5—Å</div>
</div>

<div id="mafia-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; flex-direction: column; align-items: center; justify-content: center;">
    <div style="background:#1a1a1a; border:3px solid #ff4444; padding:30px; border-radius:20px; text-align:center; max-width: 300px;">
        <h2 style="color:#ff4444;">–ó–ê–°–ê–î–ê! üî´</h2>
        <p>–ú–∞—Ñ–∏—è –ø–µ—Ä–µ–∫—Ä—ã–ª–∞ –ø—É—Ç—å. –ß—Ç–æ —Å–¥–µ–ª–∞–µ—à—å?</p>
        <button class="btn" onclick="fightMafia()" style="background: #c0392b; font-weight: bold;">üëä –î—Ä–∞—Ç—å—Å—è (–®–∞–Ω—Å 50%)</button>
        <button class="btn" onclick="payMafia()">üí∞ –û—Ç–¥–∞—Ç—å –¥–æ–ª—é (30%)</button>
        <button id="join-mafia-btn" class="btn" onclick="joinMafia()" style="background: #222; border: 1px solid #ff4444;">üï∂Ô∏è –í—Å—Ç—É–ø–∏—Ç—å –≤ –°–µ–º—å—é</button>
        <button class="btn" onclick="hideMafia()" style="background: #444; margin-top: 10px;">–£–±–µ–∂–∞—Ç—å</button>
    </div>
</div>

<div class="container" id="main-view">
    <div id="mayor-section">
        <div style="font-size: 50px;">üêπüëî</div>
        <p id="mayor-msg">"–ì–æ—Ä–æ–¥ —Ä–∞—Å—Ç—ë—Ç! –ü–æ–º–æ–≥–∏ –∂–∏—Ç–µ–ª—è–º –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Å—è –≤ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ."</p>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <button class="btn" onclick="tryGoTo(startMarketGame())">üçé –ù–∞ —Ä—ã–Ω–æ–∫</button>
            <button class="btn" onclick="tryGoTo(openCityHall())" style="background: var(--blue);">üèõÔ∏è –í –ú—ç—Ä–∏—é</button>
            <button class="btn" onclick="tryGoTo(openSkyscraper())">üè¢ –ù–µ–±–æ—Å–∫—Ä–µ–±</button>
            <button class="btn" onclick="tryGoTo(openPark())">üå≥ –í –ü–∞—Ä–∫</button>
            <button class="btn" onclick="tryGoTo(openSewer())" style="background: var(--sewer);">üï≥Ô∏è –ö–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è</button>
            <button class="btn" onclick="tryGoTo(openAirport())" style="background: #a29bfe; color: black;">‚úàÔ∏è –ê—ç—Ä–æ–ø–æ—Ä—Ç</button>
            <button class="btn" id="exit-mafia-btn" onclick="leaveMafia()" style="display:none; background:#ff4444; color:white; margin-top:10px;">üö™ –í—ã–π—Ç–∏ –∏–∑ –±–∞–Ω–¥—ã (500 üßÄ)</button>
        </div>

        <div style="margin-top: 20px; border-top: 1px solid #444; padding-top: 15px;">
            <button class="btn" onclick="window.location.href='/ratbar/'" style="background: #5d4037;">üçª –ë–∞—Ä</button>
            <button class="btn" onclick="window.location.href='/ratmetro/'" style="background: #111; color: var(--gold);">üöá –ú–µ—Ç—Ä–æ</button>
            <button class="btn" onclick="saveGame(); alert('–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');" style="background: #00d2d3; color: black;">üè¶ –°–µ–π—Ñ</button>
        </div>

        <button class="btn" onclick="resetGame()" style="background: #ff4444; margin-top: 30px; font-size: 0.7rem;">‚ö†Ô∏è –°–±—Ä–æ—Å</button>
    </div>
</div>

<div class="container" id="game-view" style="display:none;">
    <h3>–õ–æ–≤–∏ –µ–¥—É! –û—Å—Ç–∞–ª–æ—Å—å: <span id="timer">15</span>—Å</h3>
    <div id="market-game"></div>
</div>

<div class="container" id="cityhall-view">
    <h2 style="color: var(--gold);">üèõÔ∏è –ú—ç—Ä–∏—è</h2>
    <p>–í–∞—à —Å—Ç–∞—Ç—É—Å: <b id="rank-name">–ü—Ä–æ—Ö–æ–∂–∏–π</b></p>
    <div class="upgrade-card">
        <div>üí° –£–ª–∏—á–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ</div>
        <small>–î–æ—Ö–æ–¥ +1 üßÄ/5—Å</small>
        <button class="btn" onclick="upgradeCity('lights', 50)" style="float:right; padding:5px;">50 üßÄ</button>
    </div>
    <div class="upgrade-card">
        <div>üõ£Ô∏è –ù–æ–≤—ã–µ –¥–æ—Ä–æ–≥–∏</div>
        <small>–î–æ—Ö–æ–¥ +4 üßÄ/5—Å</small>
        <button class="btn" onclick="upgradeCity('roads', 150)" style="float:right; padding:5px;">150 üßÄ</button>
    </div>
    <button class="btn" onclick="exitView('cityhall-view')" style="width:100%; margin-top:10px;">–ù–∞–∑–∞–¥</button>
</div>

<div class="container" id="sewer-view">
    <h2 style="color: #888;">üï≥Ô∏è –ö–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è</h2>
    <div style="font-size: 50px;">üèöÔ∏èüêÅ</div>
    <p>–ó–¥–µ—Å—å –∂–∏–≤—É—Ç –±–µ–∑–¥–æ–º–Ω—ã–µ –º—ã—à–∏. –ü–æ–º–æ–∂–µ—à—å –∏–º –æ–±—Ä–µ—Å—Ç–∏ –¥–æ–º?</p>
    <button class="btn" onclick="rescueMouse(100)" style="background: #2ecc71; width:100%;">üè† –ö—É–ø–∏—Ç—å –∏–º –¥–æ–º (100 üßÄ)<br><small>+20 –∫ –†–µ–ø—É—Ç–∞—Ü–∏–∏</small></button>
    <button class="btn" onclick="exitView('sewer-view')" style="width:100%; margin-top:20px;">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–≤–µ—Ä—Ö</button>
</div>

<div class="container" id="island-view">
    <h2>üèùÔ∏è –ë–µ—à–µ–Ω—ã–π –û—Å—Ç—Ä–æ–≤</h2>
    <div style="font-size: 60px;">üåãüêÄüí¢</div>
    <p>–ë–µ—Ä–µ–≥–∏—Å—å! –ë–µ—à–µ–Ω—ã–µ –∫—Ä—ã—Å—ã –º–æ–≥—É—Ç –æ—Ç–æ–±—Ä–∞—Ç—å —Ç–≤–æ–π —Å—ã—Ä!</p>
    <button class="btn" onclick="searchGoldCheese()" style="background: var(--island); color: white; width:100%; font-weight:bold;">–ò—Å–∫–∞—Ç—å –ó–æ–ª–æ—Ç–æ–π –°—ã—Ä üßÄ‚ú®</button>
    <button class="btn" onclick="exitView('island-view')" style="width:100%; margin-top:20px; background: #c0392b;">–£–ª–µ—Ç–µ—Ç—å –¥–æ–º–æ–π ‚úàÔ∏è</button>
</div>

<div class="container" id="skyscraper-view" style="display:none;">
    <div style="background: #111; padding: 20px; border: 2px solid var(--gold); border-radius: 10px;">
        <h2 id="floor-title">üè¢ –•–æ–ª–ª –°–∫—Ä–µ–±–∞</h2>
        <div id="floor-content"><div style="font-size: 50px;">üõéÔ∏èüêÄ</div><p>–ö—É–¥–∞ –∂–µ–ª–∞–µ—Ç–µ –ø–æ–¥–Ω—è—Ç—å—Å—è?</p></div>
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; margin-top: 15px;">
            <button class="btn" onclick="goFloor(1)">1 —ç—Ç.</button>
            <button class="btn" onclick="goFloor(2)">2 —ç—Ç.</button>
            <button class="btn" onclick="goFloor(3)">3 —ç—Ç.</button>
        </div>
        <button class="btn" onclick="exitView('skyscraper-view')" style="width:100%; margin-top:10px;">–í—ã–π—Ç–∏</button>
    </div>
</div>

<div class="container" id="park-view" style="display:none;">
    <div style="background: #2d5a27; padding: 20px; border: 3px solid #8b4513; border-radius: 40px;">
        <h2>üå≥ –ì–æ—Ä–æ–¥—Å–∫–æ–π –ü–∞—Ä–∫</h2>
        <div id="pigeon-icon" style="font-size: 50px; transition: 0.3s;">üê¶</div>
        <p>–†–µ–ø—É—Ç–∞—Ü–∏—è: <span id="rep-count" style="color: gold;">0</span> ‚≠ê</p>
        <button class="btn" onclick="feedBirds()">–ü–æ–∫–æ—Ä–º–∏—Ç—å –ø—Ç–∏—Ü (5üßÄ)</button>
        <button class="btn" onclick="exitView('park-view')" style="width:100%; margin-top:10px;">–í—ã–π—Ç–∏</button>
    </div>
</div>

<script>
    let cheeseBalance = 0;
    let reputation = 0;
    let hasPenthouse = false;
    let cityLights = 0;
    let cityRoads = 0;
    let taxIncome = 0;
    let gameActive = false;
    let timeLeft = 15;
    let isMafiaMember = false;

    function saveGame() {
        localStorage.setItem('ratCheese', cheeseBalance);
        localStorage.setItem('ratRep', reputation);
        localStorage.setItem('ratPenthouse', hasPenthouse);
        localStorage.setItem('ratLights', cityLights);
        localStorage.setItem('ratRoads', cityRoads);
        localStorage.setItem('ratMafia', isMafiaMember);
        
    }

    function loadGame() {
        cheeseBalance = parseInt(localStorage.getItem('ratCheese')) || 0;
        reputation = parseInt(localStorage.getItem('ratRep')) || 0;
        cityLights = parseInt(localStorage.getItem('ratLights')) || 0;
        cityRoads = parseInt(localStorage.getItem('ratRoads')) || 0;
        hasPenthouse = localStorage.getItem('ratPenthouse') === 'true';
        isMafiaMember = localStorage.getItem('ratMafia') === 'true';
        updateMafiaStatus();
        calculateTaxes();
        updateDisplay();
    }

    function updateDisplay() {
        document.getElementById('balance').innerText = cheeseBalance;
        document.getElementById('tax-val').innerText = taxIncome;
        if(document.getElementById('rep-count')) document.getElementById('rep-count').innerText = reputation;
    }

    function calculateTaxes() {
        let mafiaBonus = isMafiaMember ? 10 : 0;
        taxIncome = (cityLights * 1) + (cityRoads * 4) + Math.floor(reputation / 10) + mafiaBonus;
    }

    setInterval(() => {
        if (taxIncome > 0) {
            cheeseBalance += taxIncome;
            updateDisplay();
        }
    }, 5000);

    function exitView(viewId) {
        document.getElementById(viewId).style.display = 'none';
        document.getElementById('main-view').style.display = 'block';
    }

    // –õ–û–ì–ò–ö–ê –ö–ê–ù–ê–õ–ò–ó–ê–¶–ò–ò
    function openSewer() {
        document.getElementById('main-view').style.display = 'none';
        document.getElementById('sewer-view').style.display = 'block';
    }

    function rescueMouse(cost) {
        if (cheeseBalance >= cost) {
            cheeseBalance -= cost;
            reputation += 20;
            alert("–í—ã –Ω–∞—Å—Ç–æ—è—â–∏–π –≥–µ—Ä–æ–π! –ú—ã—à–∏ –ø–µ—Ä–µ–µ—Ö–∞–ª–∏ –≤ –≥–æ—Ä–æ–¥. –†–µ–ø—É—Ç–∞—Ü–∏—è +20!");
            saveGame();
            updateDisplay();
        } else { alert("–ú–∞–ª–æ —Å—ã—Ä–∞!"); }
    }

    // –õ–û–ì–ò–ö–ê –ê–≠–†–û–ü–û–†–¢–ê –ò –û–°–¢–†–û–í–ê
    function openAirport() {
        if (confirm("–ë–∏–ª–µ—Ç –Ω–∞ –ë–µ—à–µ–Ω—ã–π –û—Å—Ç—Ä–æ–≤ —Å—Ç–æ–∏—Ç 50 üßÄ. –õ–µ—Ç–∏–º?")) {
            if (cheeseBalance >= 50) {
                cheeseBalance -= 50;
                document.getElementById('main-view').style.display = 'none';
                document.getElementById('island-view').style.display = 'block';
                updateDisplay();
            } else { alert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞ –±–∏–ª–µ—Ç!"); }
        }
    }

    function searchGoldCheese() {
        let r = Math.random();
        if (r > 0.6) {
            let win = Math.floor(Math.random() * 100) + 50;
            cheeseBalance += win;
            alert("‚ú® –ü–æ–±–µ–¥–∞! –í—ã –Ω–∞—à–ª–∏ –ó–æ–ª–æ—Ç–æ–π –°—ã—Ä –∏ –ø—Ä–æ–¥–∞–ª–∏ –µ–≥–æ –∑–∞ " + win + " üßÄ!");
        } else if (r > 0.2) {
            alert("–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à–ª–∏, —Ç–æ–ª—å–∫–æ –∏—Å–ø–∞—á–∫–∞–ª–∏ –ª–∞–ø–∫–∏.");
        } else {
            let loss = Math.floor(cheeseBalance * 0.2);
            cheeseBalance -= loss;
            alert("üí¢ –û–ô! –ë–µ—à–µ–Ω—ã–µ –∫—Ä—ã—Å—ã –æ—Ç–æ–±—Ä–∞–ª–∏ —É –≤–∞—Å —á–∞—Å—Ç—å –ø—Ä–∏–ø–∞—Å–æ–≤ (-" + loss + " üßÄ)!");
        }
        saveGame();
        updateDisplay();
    }

    // –û–°–¢–ê–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê (–†–´–ù–û–ö, –ú–≠–†–ò–Ø, –ù–ï–ë–û–°–ö–†–ï–ë)
    function openCityHall() {
        document.getElementById('main-view').style.display = 'none';
        document.getElementById('cityhall-view').style.display = 'block';
        updateCityHallUI();
    }

    function updateCityHallUI() {
        calculateTaxes();
        let rank = "–ü—Ä–æ—Ö–æ–∂–∏–π";
        if (reputation > 5) rank = "–ú–µ—Å—Ç–Ω—ã–π";
        if (reputation > 30) rank = "–ë–ª–∞–≥–æ–¥–µ—Ç–µ–ª—å";
        if (hasPenthouse) rank = "–≠–ª–∏—Ç–∞ –ì—Ä–∞–¥–∞";
        document.getElementById('rank-name').innerText = rank;
    }

    function upgradeCity(type, cost) {
        if (cheeseBalance >= cost) {
            cheeseBalance -= cost;
            if (type === 'lights') cityLights++;
            if (type === 'roads') cityRoads++;
            calculateTaxes();
            saveGame();
            updateCityHallUI();
            updateDisplay();
            alert("–ì–æ—Ä–æ–¥ —Å—Ç–∞–ª –ª—É—á—à–µ!");
        } else { alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—ã—Ä–∞!"); }
    }

    function startMarketGame() {
        document.getElementById('main-view').style.display = 'none';
        document.getElementById('game-view').style.display = 'block';
        document.getElementById('market-game').style.display = 'block';
        gameActive = true; timeLeft = 15; spawnItems();
        let timerFunc = setInterval(() => {
            timeLeft--;
            document.getElementById('timer').innerText = timeLeft;
            if (timeLeft <= 0) { clearInterval(timerFunc); endGame(); }
        }, 1000);
    }

    function spawnItems() {
        if (!gameActive) return;
        const gameZone = document.getElementById('market-game');
        const item = document.createElement('div');
        item.className = 'falling-item';
        item.innerText = ['üßÄ', 'üåæ', 'üçé', 'ü•ú'][Math.floor(Math.random() * 4)];
        item.style.left = Math.random() * (gameZone.offsetWidth - 30) + 'px';
        item.style.top = '-40px';
        gameZone.appendChild(item);
        let fall = setInterval(() => {
            let top = parseInt(item.style.top);
            if (top > 300 || !gameActive) { clearInterval(fall); if (item.parentNode) gameZone.removeChild(item); }
            else { item.style.top = (top + 5) + 'px'; }
        }, 30);
        item.onclick = () => {
    let loot = isMafiaMember ? 5 : 2; // –í–æ—Ä—É–µ–º 5, –µ—Å–ª–∏ –≤ –º–∞—Ñ–∏–∏
    cheeseBalance += loot;
    if (isMafiaMember) reputation = Math.max(-100, reputation - 1); // –†–µ–ø–∞ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –∫—Ä–∞–∂–µ
    updateDisplay();
    clearInterval(fall);
    if (item.parentNode) gameZone.removeChild(item);
};
        setTimeout(spawnItems, 600);
    }

    function endGame() {
        gameActive = false;
        document.getElementById('market-game').innerHTML = '';
        exitView('game-view');
        saveGame();
    }

    function openSkyscraper() { document.getElementById('main-view').style.display = 'none'; document.getElementById('skyscraper-view').style.display = 'block'; }
    function goFloor(num) {
        const title = document.getElementById('floor-title');
        const content = document.getElementById('floor-content');
        if (num === 3) {
            title.innerText = "–≠—Ç–∞–∂ 3: –ü–µ–Ω—Ç—Ö–∞—É—Å";
            if (hasPenthouse) content.innerHTML = `<div style="font-size: 60px;">üëë</div><p>–í–∞—à–∏ –ø–æ–∫–æ–∏!</p>`;
            else content.innerHTML = `<p>–¶–µ–Ω–∞: 200 üßÄ</p><button class="btn" onclick="buyPenthouse()">–ö—É–ø–∏—Ç—å</button>`;
        } else {
            const data = { 1: {t: "–ö–∏–±–µ—Ä-–Ω–æ—Ä–∞", i: "üíª"}, 2: {t: "–°—Ç—É–¥–∏—è", i: "üé®"} }[num];
            title.innerText = data.t; content.innerHTML = `<div style="font-size: 50px;">${data.i}</div>`;
        }
    }

    function buyPenthouse() {
        if (cheeseBalance >= 200) { cheeseBalance -= 200; hasPenthouse = true; saveGame(); updateDisplay(); goFloor(3); }
        else { alert("–ú–∞–ª–æ —Å—ã—Ä–∞!"); }
    }

    function openPark() { document.getElementById('main-view').style.display = 'none'; document.getElementById('park-view').style.display = 'block'; }
    function feedBirds() {
        if (cheeseBalance >= 5) {
            cheeseBalance -= 5; reputation += 1; updateDisplay(); saveGame();
            const icon = document.getElementById('pigeon-icon');
            icon.style.transform = "scale(1.4)"; setTimeout(() => icon.style.transform = "scale(1)", 200);
        } else { alert("–ú–∞–ª–æ —Å—ã—Ä–∞!"); }
    }

    function tryGoTo(target, startFunction = null) {
    // 1. –ü–†–û–í–ï–†–ö–ê –ú–ê–§–ò–ò
    if (!isMafiaMember && cheeseBalance > 50 && Math.random() < 0.2) {
        window.pendingLocation = { target: target, func: startFunction };
        document.getElementById('mafia-overlay').style.display = 'flex';
        
        const joinBtn = document.getElementById('join-mafia-btn');
        if (joinBtn) {
            joinBtn.disabled = (reputation >= 10);
            joinBtn.innerText = reputation >= 10 ? "–ù—É–∂–Ω–∞ —Ä–µ–ø–∞ < 10" : "üï∂Ô∏è –í—Å—Ç—É–ø–∏—Ç—å –≤ –°–µ–º—å—é";
            joinBtn.style.opacity = reputation >= 10 ? "0.3" : "1";
        }
        return; 
    }

    // 2. –°–ö–†–´–í–ê–ï–ú –í–°–ï –û–ö–ù–ê
    // –ú—ã –ø—Ä—è—á–µ–º –≤—Å—ë, —á—Ç–æ –∏–º–µ–µ—Ç –∫–ª–∞—Å—Å container –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    document.querySelectorAll('.container').forEach(c => c.style.display = 'none');
    document.getElementById('main-view').style.display = 'none';

    // 3. –ü–ï–†–ï–•–û–î
    if (typeof target === 'function') {
        // –ï—Å–ª–∏ —Ç—ã –ø–µ—Ä–µ–¥–∞–ª —Ñ—É–Ω–∫—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: tryGoTo(openSewer))
        target(); 
    } else if (typeof target === 'string') {
        // –ï—Å–ª–∏ —Ç—ã –ø–µ—Ä–µ–¥–∞–ª ID (–Ω–∞–ø—Ä–∏–º–µ—Ä: tryGoTo('sewer-view'))
        const targetEl = document.getElementById(target);
        if (targetEl) {
            targetEl.style.display = 'block';
            if (startFunction) startFunction();
        } else {
            // –ï—Å–ª–∏ ID –Ω–µ –Ω–∞–π–¥–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–µ–Ω—é, —á—Ç–æ–±—ã —ç–∫—Ä–∞–Ω –Ω–µ –±—ã–ª –ø—É—Å—Ç—ã–º
            document.getElementById('main-view').style.display = 'block';
        }
    }
    }
    
// 2. –õ–æ–≥–∏–∫–∞ –î—Ä–∞–∫–∏, –û—Ç–∫—É–ø–∞ –∏ –í—Å—Ç—É–ø–ª–µ–Ω–∏—è
function fightMafia() {
    if (Math.random() > 0.5) {
        reputation += 10;
        alert("üëä –ü–û–ë–ï–î–ê! –¢—ã —Ä–∞—Å–∫–∏–¥–∞–ª –±–∞–Ω–¥–∏—Ç–æ–≤. –†–µ–ø—É—Ç–∞—Ü–∏—è +10!");
        hideMafia(); proceedToPending();
    } else {
        alert("ü§ï –ü–û–†–ê–ñ–ï–ù–ò–ï... –ú–∞—Ñ–∏—è –∏–∑–±–∏–ª–∞ —Ç–µ–±—è –∏ –∑–∞–±—Ä–∞–ª–∞ –í–ï–°–¨ —Å—ã—Ä!");
        cheeseBalance = 0; reputation = Math.max(0, reputation - 5);
        hideMafia(); exitView('main-view');
    }
    updateDisplay(); saveGame();
}

function payMafia() {
    let loss = Math.floor(cheeseBalance * 0.3);
    cheeseBalance -= loss;
    alert("–ú–∞—Ñ–∏—è –∑–∞–±—Ä–∞–ª–∞ –¥–æ–ª—é. –ü—Ä–æ—Ö–æ–¥–∏...");
    hideMafia(); proceedToPending();
    updateDisplay(); saveGame();
}

function joinMafia() {
    isMafiaMember = true;
    reputation = 0;
    alert("üï∂Ô∏è –¢—ã —Ç–µ–ø–µ—Ä—å –≤ –°–µ–º—å–µ. –ù–∞ —Ä—ã–Ω–∫–µ –º–æ–∂–Ω–æ –≤–æ—Ä–æ–≤–∞—Ç—å!");
    hideMafia(); updateMafiaStatus(); proceedToPending();
    updateDisplay(); saveGame();
}

// 3. –í—ã—Ö–æ–¥ –∏–∑ –±–∞–Ω–¥—ã –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
function leaveMafia() {
    if (cheeseBalance >= 500) {
        cheeseBalance -= 500; isMafiaMember = false; reputation = 5;
        alert("–¢—ã –≤—ã–ø–ª–∞—Ç–∏–ª 500 —Å—ã—Ä–∞ –∏ –ø–æ–∫–∏–Ω—É–ª –±–∞–Ω–¥—É!");
        updateMafiaStatus(); updateDisplay(); saveGame();
    } else { alert("–ù—É–∂–Ω–æ 500 üßÄ, —á—Ç–æ–±—ã —É–π—Ç–∏!"); }
}

function updateMafiaStatus() {
    const marketBtn = document.querySelector("button[onclick*='startMarketGame']");
    const exitBtn = document.getElementById('exit-mafia-btn');
    if (isMafiaMember) {
        marketBtn.innerText = "üî´ –û–≥—Ä–∞–±–∏—Ç—å —Ä—ã–Ω–æ–∫";
        exitBtn.style.display = "block";
    } else {
        marketBtn.innerText = "üçé –ù–∞ —Ä—ã–Ω–æ–∫";
        exitBtn.style.display = "none";
    }
}

// 4. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤—å)
function hideMafia() { document.getElementById('mafia-overlay').style.display = 'none'; }
function proceedToPending() {
    if (window.pendingLocation) {
        const p = window.pendingLocation;
        // –ü—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ–º tryGoTo —Å–Ω–æ–≤–∞, –Ω–æ –º–∞—Ñ–∏—è —É–∂–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç (—Ç.–∫. –º—ã –≤—ã–∑–≤–∞–ª–∏ hideMafia)
        // –ú—ã –ø–µ—Ä–µ–¥–∞–µ–º —Ç–µ –∂–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã, —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏
        tryGoTo(p.target, p.func);
        window.pendingLocation = null;
    }
}
    
    function resetGame() { if (confirm("–£–¥–∞–ª–∏—Ç—å –≥–æ—Ä–æ–¥?")) { localStorage.clear(); location.reload(); } }
    window.onload = loadGame;
</script>
</body>
</html>
